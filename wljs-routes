server {
  listen 3000;

  location / {
    include snippets/proxy.conf;

    # Replaces request inside the html made to the websocket ports to the nginx location endpoints
    sub_filter_once off;
    sub_filter_types *;
    sub_filter '"ws://"' '(window.location.protocol == "https://" ? "wss://" : "ws://")'
    sub_filter "4001" "'3000/ws/'";
    sub_filter "4002" "'3000/ws2/'";

    proxy_pass http://127.0.0.1:4000/;
  }

  location /ws/ {
    include snippets/proxy.conf;

    proxy_pass http://127.0.0.1:4001/;
  }

  location /ws2/ {
    include snippets/proxy.conf;

    proxy_pass http://127.0.0.1:4002/;
  }

}
